<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üì§ ‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶™‡¶≤‡ßã‡¶°</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<style>
/* ================= CSS ================= */
body{font-family:sans-serif;background:#333;color:white;padding:20px;}
.upload-zone{border:2px dashed #fff;padding:50px;text-align:center;cursor:pointer;margin:20px 0;}
.toast{position:fixed;top:20px;right:20px;background:#0f0;color:#000;padding:10px 20px;border-radius:10px;}
#filesGrid div{padding:10px;border-bottom:1px solid #555;}
</style>
</head>
<body>

<h1>üì§ ‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶™‡¶≤‡ßã‡¶°</h1>

<div id="userUpload">
    <div id="qrCode"></div>
    <div class="upload-zone" id="uploadZone">
        ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï/‡¶°‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®
        <input type="file" id="fileInput" multiple>
    </div>
    <div id="uploadStatus"></div>
</div>

<div id="adminLogin" style="display:none;">
    <h2>üîê ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶≤‡¶ó‡¶á‡¶®</h2>
    <input type="password" id="adminSecret" placeholder="‡¶∏‡¶ø‡¶ï‡ßç‡¶∞‡ßá‡¶ü ‡¶ï‡ßÄ">
    <button onclick="app.adminLogin()">‡¶≤‡¶ó‡¶á‡¶®</button>
</div>

<div id="adminDashboard" style="display:none;">
    <h2>üìä ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</h2>
    <button onclick="app.logout()">‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</button>
    <div id="stats"></div>
    <div id="filesGrid"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

// ====== Firebase Config ======
const firebaseConfig = {
  apiKey: "AIzaSyBYFovE-TtHXcKpatJBjB4CPoODbIUCBdI",
  authDomain: "easyshare-e5aea.firebaseapp.com",
  databaseURL: "https://easyshare-e5aea-default-rtdb.firebaseio.com",
  projectId: "easyshare-e5aea",
  storageBucket: "easyshare-e5aea.appspot.com",
  messagingSenderId: "454044842251",
  appId: "1:454044842251:web:94b5c7bf2ff72ed7744a0e",
  measurementId: "G-RVJLVGV8XR"
};

const firebaseApp = initializeApp(firebaseConfig);
const database = getDatabase(firebaseApp);

// ====== App ======
class MultiTabSecretDB{
    constructor(){
        this.SECRET_KEY = "mysecret2026";
        this.files = [];
        this.isAdmin = false;
        this.init();
    }

    async init(){
        await this.loadFiles();
        this.bindEvents();
        this.generateQR();
    }

    async loadFiles(){
        try{
            const snapshot = await get(ref(database,'files'));
            this.files = snapshot.exists()? snapshot.val(): [];
            if(this.isAdmin) this.renderFiles();
        }catch(e){ console.error(e); }
    }

    async saveFiles(){
        try{
            await set(ref(database,'files'),this.files);
            this.showToast("‚úÖ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§!");
        }catch(e){ console.error(e); this.showToast("‚ùå ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•!"); }
    }

    bindEvents(){
        const uploadZone=document.getElementById('uploadZone');
        const fileInput=document.getElementById('fileInput');

        uploadZone.onclick = ()=> fileInput.click();
        fileInput.onchange = e=>{ this.handleFiles(e.target.files); e.target.value=''; }

        document.getElementById('adminSecret').addEventListener('keypress', e=>{
            if(e.key==='Enter') this.adminLogin();
        });
    }

    async handleFiles(files){
        Array.from(files).forEach(file=>{
            if(file.size>50*1024*1024){ this.showToast('‚ùå ‡ß´‡ß¶MB ‡¶è‡¶∞ ‡¶¨‡ßá‡¶∂‡¶ø ‡¶®‡ßü'); return; }
            const reader=new FileReader();
            reader.onload=async ()=>{
                const fileData={
                    id: Date.now()+'_'+Math.random().toString(36),
                    name:file.name,
                    size:file.size,
                    data:reader.result,
                    time:new Date().toLocaleString('bn-BD')
                };
                this.files.unshift(fileData);
                await this.saveFiles();
                this.showToast(`‚úÖ ${file.name} ‡¶Ü‡¶™‡¶≤‡ßã‡¶°`);
            };
            reader.readAsDataURL(file);
        });
    }

    adminLogin(){
        const secret=document.getElementById('adminSecret').value;
        if(secret===this.SECRET_KEY){
            this.isAdmin=true;
            document.getElementById('userUpload').style.display='none';
            document.getElementById('adminLogin').style.display='none';
            document.getElementById('adminDashboard').style.display='block';
            this.renderFiles();
            this.showToast('‚úÖ ‡¶≤‡¶ó‡¶á‡¶® ‡¶∏‡¶´‡¶≤!');
        }else this.showToast('‚ùå ‡¶≠‡ßÅ‡¶≤ ‡¶∏‡¶ø‡¶ï‡ßç‡¶∞‡ßá‡¶ü!');
    }

    logout(){
        this.isAdmin=false;
        document.getElementById('adminDashboard').style.display='none';
        document.getElementById('adminLogin').style.display='block';
    }

    renderFiles(){
        const container=document.getElementById('filesGrid');
        if(!this.files.length){ container.innerHTML='<p>‡¶ï‡ßã‡¶®‡ßã ‡¶´‡¶æ‡¶á‡¶≤ ‡¶®‡ßá‡¶á</p>'; return; }
        container.innerHTML=this.files.map(f=>`<div>${f.name} ‚Ä¢ ${f.time}</div>`).join('');
        document.getElementById('stats').innerText=`‡¶Æ‡ßã‡¶ü ‡¶´‡¶æ‡¶á‡¶≤: ${this.files.length}`;
    }

    generateQR(){
        new QRCode(document.getElementById('qrCode'), { text: window.location.href, width:200, height:200 });
    }

    showToast(msg){
        const toast=document.createElement('div');
        toast.className='toast';
        toast.textContent=msg;
        document.body.appendChild(toast);
        setTimeout(()=>toast.remove(),3000);
    }
}

window.app=new MultiTabSecretDB();
</script>
</body>
</html>
